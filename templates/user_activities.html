{% extends "base.html" %}
{% block title %}Activit√©s ¬∑ {{ user.first_name or user.email }}{% endblock %}

{% block extra_head %}
<style>
  .activities-table {
    width:100%;
    border-collapse:collapse;
    font-size:0.9rem;
  }
  .activities-table th,
  .activities-table td {
    padding:8px 6px;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
    white-space:nowrap;
  }
  .activities-table th {
    background:#f8fafc;
    font-weight:600;
  }
  .activities-table td:last-child,
  .activities-table th:last-child {
    text-align:center;
  }
  .table-wrapper {
    overflow-x:auto;
  }
  @media (max-width: 720px) {
    .activities-table th,
    .activities-table td {
      white-space:normal;
    }
  }
</style>
{% endblock %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:16px;">
  <div>
    <h1 style="margin:0; font-size:1.2rem;">üìö Activit√©s r√©centes</h1>
    <p class="muted" style="margin:4px 0 0 0;">
      Les 30 derni√®res activit√©s de {{ user.first_name or user.email }} avec distance, D+/D- et fen√™tres D+.
    </p>
  </div>
  <a href="/ui/user/{{ user.id }}"
     style="text-decoration:none; font-weight:600; color:#0f172a;">
    ‚Üê Retour au dashboard
  </a>
</div>

<div class="card" style="padding:16px;">
  {% if activities %}
    <div class="table-wrapper">
      <table class="activities-table">
        <thead>
          <tr>
            <th></th>
            <th>Activit√©</th>
            <th>Date</th>
            <th>Distance</th>
            <th>D+</th>
            <th>D-</th>
            <th>Dur√©e</th>
            {% for win in window_defs %}
              <th>D+ {{ win.label }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in activities %}
            <tr>
              <td style="font-size:1.2rem; text-align:center;">
                {% set sport = (row.sport or '')|lower %}
                {% if sport in ['run', 'trailrun', 'trail run'] %}
                  üèÉ
                {% elif sport in ['ride', 'virtualride', 'ebikeride', 'gravelride', 'mountainbike', 'mtb'] %}
                  üö¥
                {% elif sport in ['ski_alpine', 'ski', 'alpineski', 'backcountryski'] %}
                  üéø
                {% elif sport in ['ski_nordic', 'rollerski'] %}
                  ‚õ∑Ô∏è
                {% elif sport in ['hike', 'walk'] %}
                  üö∂
                {% else %}
                  ‚ö™
                {% endif %}
              </td>
              <td>
                <a href="/ui/user/{{ user.id }}/activity/{{ row.id }}"
                   style="text-decoration:none; color:#1d4ed8; font-weight:600;">
                  {{ row.name|truncate(30, True, '‚Ä¶') }}
                </a>
              </td>
              <td>{{ row.start_label }}</td>
              <td>
                {% if row.distance_km is not none %}
                  {{ '%.1f'|format(row.distance_km) }} km
                {% else %}‚Äì{% endif %}
              </td>
              <td>
                {% if row.elevation_gain_m is not none %}
                  {{ row.elevation_gain_m|round(0)|int }} m
                {% else %}‚Äì{% endif %}
              </td>
              <td>
                {% if row.elevation_loss_m is not none %}
                  {{ row.elevation_loss_m|round(0)|int }} m
                {% else %}‚Äì{% endif %}
              </td>
              <td>{{ row.duration_str or "‚Äì" }}</td>
              {% for win in window_defs %}
                {% set value = row.dplus_windows.get(win.id) if row.dplus_windows else None %}
                <td>
                  {% if value is not none %}
                    {{ value|round(0)|int }} m
                  {% else %}‚Äì{% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted" style="margin:0;">
      Aucune activit√© disponible pour cet utilisateur.
    </p>
  {% endif %}
</div>
{% endblock %}
